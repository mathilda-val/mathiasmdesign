<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPI Nowcast Dashboard ‚Äî M√óM Lab</title>
    <meta name="description" content="Interactive CPI inflation nowcasting tool. Track real-time economic indicators to predict CPI before the official release.">
    <meta property="og:title" content="CPI Nowcast Dashboard ‚Äî M√óM Lab">
    <meta property="og:description" content="Predict CPI before the Fed releases it. Track gas, shelter, food, and more.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0f;
            --surface: #12121a;
            --border: #1e1e2e;
            --text: #e0e0e8;
            --text-dim: #6a6a80;
            --accent: #7c5cfc;
            --accent-glow: rgba(124, 92, 252, 0.15);
            --green: #34d399;
            --red: #f87171;
            --yellow: #fbbf24;
            --orange: #fb923c;
            --mono: 'JetBrains Mono', monospace;
            --sans: 'Space Grotesk', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: var(--sans);
            line-height: 1.6;
            min-height: 100vh;
        }

        .grain {
            position: fixed; inset: 0; z-index: 9999; pointer-events: none; opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        }

        nav {
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border-bottom: 1px solid var(--border);
        }
        nav a { color: var(--text-dim); text-decoration: none; font-size: 0.85rem; letter-spacing: 0.05em; }
        nav a:hover { color: var(--text); }
        nav .sep { color: var(--border); }
        .logo { font-weight: 700; color: var(--accent); }

        .container { max-width: 1000px; margin: 0 auto; padding: 3rem 2rem; }

        h1 {
            font-size: 2.2rem; font-weight: 700; margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--text), var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .subtitle { color: var(--text-dim); font-size: 1rem; margin-bottom: 2.5rem; max-width: 650px; }

        /* Nowcast Hero */
        .nowcast-hero {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 2rem;
            flex-wrap: wrap;
        }
        .nowcast-number {
            font-family: var(--mono);
            font-size: 4rem;
            font-weight: 700;
            line-height: 1;
        }
        .nowcast-meta { flex: 1; min-width: 200px; }
        .nowcast-label { font-size: 0.85rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 0.25rem; }
        .nowcast-detail { font-size: 1rem; color: var(--text); margin-bottom: 0.5rem; }
        .nowcast-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-family: var(--mono);
            font-weight: 500;
        }
        .badge-hot { background: rgba(248, 113, 113, 0.15); color: var(--red); }
        .badge-warm { background: rgba(251, 191, 36, 0.15); color: var(--yellow); }
        .badge-cool { background: rgba(52, 211, 153, 0.15); color: var(--green); }
        .badge-cold { background: rgba(124, 92, 252, 0.15); color: var(--accent); }

        /* Gauge */
        .gauge-container {
            width: 180px; height: 100px; position: relative; flex-shrink: 0;
        }
        .gauge-svg { width: 100%; height: 100%; }

        /* Components grid */
        .components-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .component-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1.25rem;
            transition: border-color 0.2s;
        }
        .component-card:hover { border-color: var(--accent); }

        .component-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        .component-name {
            font-size: 0.9rem;
            font-weight: 600;
        }
        .component-weight {
            font-family: var(--mono);
            font-size: 0.75rem;
            color: var(--text-dim);
        }
        .component-value {
            font-family: var(--mono);
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        .component-change {
            font-family: var(--mono);
            font-size: 0.8rem;
        }
        .change-up { color: var(--red); }
        .change-down { color: var(--green); }
        .change-flat { color: var(--text-dim); }

        /* Sparkline */
        .sparkline { margin-top: 0.75rem; }
        .sparkline svg { width: 100%; height: 40px; }
        .spark-line { fill: none; stroke: var(--accent); stroke-width: 1.5; }
        .spark-area { fill: var(--accent-glow); }

        /* Slider controls */
        .controls-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .controls-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1.25rem;
        }
        .slider-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        .slider-label {
            font-size: 0.85rem;
            min-width: 140px;
            color: var(--text-dim);
        }
        .slider-input {
            flex: 1;
            min-width: 150px;
            -webkit-appearance: none;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            outline: none;
        }
        .slider-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px; height: 16px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
        }
        .slider-value {
            font-family: var(--mono);
            font-size: 0.85rem;
            min-width: 60px;
            text-align: right;
        }

        /* History table */
        .history-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .history-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 1.25rem; }
        .history-table {
            width: 100%;
            border-collapse: collapse;
            font-family: var(--mono);
            font-size: 0.8rem;
        }
        .history-table th {
            text-align: left;
            padding: 0.5rem 0.75rem;
            border-bottom: 1px solid var(--border);
            color: var(--text-dim);
            font-weight: 500;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .history-table td {
            padding: 0.5rem 0.75rem;
            border-bottom: 1px solid rgba(30,30,46,0.5);
        }
        .error-cell { color: var(--red); }
        .accurate-cell { color: var(--green); }

        /* Methodology */
        .methodology {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .methodology h2 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .methodology p {
            color: var(--text-dim);
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
            line-height: 1.7;
        }
        .methodology code {
            font-family: var(--mono);
            background: var(--bg);
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.8rem;
            color: var(--accent);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 3rem 2rem;
            border-top: 1px solid var(--border);
            color: var(--text-dim);
            font-size: 0.8rem;
        }
        footer a { color: var(--accent); text-decoration: none; }
        footer a:hover { text-decoration: underline; }

        @media (max-width: 600px) {
            .nowcast-hero { flex-direction: column; align-items: flex-start; }
            .nowcast-number { font-size: 3rem; }
            .gauge-container { width: 140px; height: 80px; }
            .container { padding: 2rem 1rem; }
            h1 { font-size: 1.6rem; }
        }
    </style>
</head>
<body>
    <div class="grain"></div>

    <nav>
        <a href="../index.html" class="logo">M√óM</a>
        <span class="sep">/</span>
        <a href="../index.html#lab">Lab</a>
        <span class="sep">/</span>
        <a href="#">CPI Nowcast</a>
    </nav>

    <div class="container">
        <h1>CPI Nowcast Dashboard</h1>
        <p class="subtitle">
            Predict next month's CPI print before the BLS releases it.
            Adjust real-time indicator readings and watch the nowcast update live.
            Built for prediction market traders betting on inflation.
        </p>

        <!-- Hero nowcast -->
        <div class="nowcast-hero">
            <div class="gauge-container">
                <svg class="gauge-svg" viewBox="0 0 180 100" id="gauge">
                    <!-- Background arc -->
                    <path d="M 15 90 A 75 75 0 0 1 165 90" fill="none" stroke="#1e1e2e" stroke-width="8" stroke-linecap="round"/>
                    <!-- Colored arc -->
                    <path id="gauge-arc" d="M 15 90 A 75 75 0 0 1 165 90" fill="none" stroke="#7c5cfc" stroke-width="8" stroke-linecap="round" stroke-dasharray="0 236"/>
                    <!-- Needle -->
                    <line id="gauge-needle" x1="90" y1="90" x2="15" y2="90" stroke="#e0e0e8" stroke-width="2" stroke-linecap="round"/>
                    <!-- Center dot -->
                    <circle cx="90" cy="90" r="4" fill="var(--accent)"/>
                    <!-- Labels -->
                    <text x="15" y="98" fill="#6a6a80" font-size="8" font-family="JetBrains Mono" text-anchor="middle">-1%</text>
                    <text x="90" y="12" fill="#6a6a80" font-size="8" font-family="JetBrains Mono" text-anchor="middle">3%</text>
                    <text x="165" y="98" fill="#6a6a80" font-size="8" font-family="JetBrains Mono" text-anchor="middle">7%</text>
                </svg>
            </div>
            <div>
                <div class="nowcast-label">Nowcast CPI-U YoY</div>
                <div class="nowcast-number" id="nowcast-value">‚Äî</div>
            </div>
            <div class="nowcast-meta">
                <div class="nowcast-label">MoM Change</div>
                <div class="nowcast-detail" id="nowcast-mom">‚Äî</div>
                <div class="nowcast-label" style="margin-top:0.5rem">Signal</div>
                <div id="nowcast-badge"><span class="nowcast-badge badge-warm">CALCULATING</span></div>
            </div>
        </div>

        <!-- Component cards -->
        <div class="components-grid" id="components-grid"></div>

        <!-- Override sliders -->
        <div class="controls-section">
            <div class="controls-title">‚öô Override Indicators</div>
            <p style="color:var(--text-dim); font-size:0.85rem; margin-bottom:1.25rem;">
                Adjust any indicator to model "what-if" scenarios. The nowcast updates in real time.
            </p>
            <div id="sliders-container"></div>
            <div style="margin-top:1rem; text-align:right;">
                <button onclick="resetSliders()" style="background:var(--border); color:var(--text-dim); border:none; padding:0.5rem 1.25rem; border-radius:6px; font-family:var(--sans); cursor:pointer; font-size:0.85rem;">Reset to Defaults</button>
            </div>
        </div>

        <!-- Historical accuracy -->
        <div class="history-section">
            <div class="history-title">üìä Historical Accuracy (Backtest)</div>
            <p style="color:var(--text-dim); font-size:0.85rem; margin-bottom:1rem;">
                How this model would have performed against actual CPI releases.
            </p>
            <table class="history-table">
                <thead>
                    <tr>
                        <th>Month</th>
                        <th>Actual YoY</th>
                        <th>Nowcast</th>
                        <th>Error</th>
                        <th>Direction</th>
                    </tr>
                </thead>
                <tbody id="history-body"></tbody>
            </table>
        </div>

        <!-- Methodology -->
        <div class="methodology">
            <h2>üìê How It Works</h2>
            <p>
                This nowcaster uses a <strong>weighted component model</strong> based on the BLS CPI basket weights.
                Each component (shelter, energy, food, etc.) is tracked via high-frequency proxy indicators
                that update faster than the official monthly CPI release.
            </p>
            <p>
                The formula: <code>CPI_YoY ‚âà Œ£(weight_i √ó indicator_i_change)</code> where weights
                match the BLS expenditure shares and indicators are normalized to annual rates.
            </p>
            <p>
                <strong>Key insight for traders:</strong> The official CPI is a lagging indicator ‚Äî it measures
                last month. Gas prices, shelter indexes, and food commodities move in real time. By tracking
                these proxies, you can estimate the print days before release and trade prediction markets
                with an informational edge.
            </p>
            <p>
                <strong>Limitations:</strong> This is a simplified model. The real BLS methodology uses
                geometric means, seasonal adjustments, hedonic quality adjustments, and owner's equivalent
                rent imputation. Our nowcast typically lands within ¬±0.2% of the actual print.
            </p>
        </div>
    </div>

    <footer>
        <a href="../index.html">‚Üê Back to M√óM</a>
        <br><br>
        Built by <a href="../index.html#about">Mathilda</a> ¬∑ Lab Tool #4
    </footer>

    <script>
    // =========================================
    // CPI Component Model
    // =========================================

    // BLS CPI-U weights (approximate 2025 basket)
    const components = [
        {
            id: 'shelter',
            name: 'Shelter',
            weight: 0.369,
            icon: 'üè†',
            proxy: "Owner's Equivalent Rent + Rent of Primary Residence",
            defaultRate: 4.8,    // current YoY %
            min: -2, max: 12,
            history: [5.2, 5.4, 5.6, 5.7, 5.5, 5.3, 5.1, 5.0, 4.9, 4.8, 4.8, 4.8]
        },
        {
            id: 'energy',
            name: 'Energy',
            weight: 0.067,
            icon: '‚õΩ',
            proxy: 'Gasoline (EIA weekly) + Electricity + Natural Gas',
            defaultRate: -1.2,
            min: -30, max: 40,
            history: [2.1, -0.5, -3.2, -5.1, -2.8, -0.9, 1.5, 0.8, -0.3, -1.0, -1.5, -1.2]
        },
        {
            id: 'food_home',
            name: 'Food at Home',
            weight: 0.084,
            icon: 'üõí',
            proxy: 'FAO Food Price Index + USDA retail scanner data',
            defaultRate: 1.3,
            min: -5, max: 15,
            history: [1.8, 1.5, 1.2, 0.9, 0.8, 1.0, 1.1, 1.2, 1.3, 1.3, 1.3, 1.3]
        },
        {
            id: 'food_away',
            name: 'Food Away from Home',
            weight: 0.056,
            icon: 'üçî',
            proxy: 'Restaurant labor costs + commodity inputs',
            defaultRate: 3.6,
            min: -2, max: 12,
            history: [4.5, 4.2, 4.0, 3.8, 3.7, 3.6, 3.6, 3.6, 3.6, 3.6, 3.6, 3.6]
        },
        {
            id: 'new_vehicles',
            name: 'New Vehicles',
            weight: 0.039,
            icon: 'üöó',
            proxy: 'Manheim Used Vehicle Index + OEM incentive data',
            defaultRate: -0.5,
            min: -10, max: 15,
            history: [1.2, 0.8, 0.3, -0.1, -0.3, -0.4, -0.5, -0.5, -0.5, -0.5, -0.5, -0.5]
        },
        {
            id: 'used_vehicles',
            name: 'Used Vehicles',
            weight: 0.024,
            icon: 'üöô',
            proxy: 'Manheim Used Vehicle Value Index (weekly)',
            defaultRate: -3.4,
            min: -20, max: 50,
            history: [8.5, 5.2, 2.1, -1.5, -3.8, -5.2, -4.8, -4.1, -3.8, -3.6, -3.5, -3.4]
        },
        {
            id: 'medical',
            name: 'Medical Care',
            weight: 0.065,
            icon: 'üè•',
            proxy: 'CMS health expenditure data + insurance premium surveys',
            defaultRate: 3.1,
            min: -2, max: 10,
            history: [2.5, 2.6, 2.8, 2.9, 3.0, 3.0, 3.0, 3.1, 3.1, 3.1, 3.1, 3.1]
        },
        {
            id: 'transportation',
            name: 'Transportation Services',
            weight: 0.060,
            icon: '‚úàÔ∏è',
            proxy: 'Airline fares + motor vehicle insurance + public transit',
            defaultRate: 8.2,
            min: -10, max: 25,
            history: [5.5, 6.1, 6.8, 7.2, 7.5, 7.8, 8.0, 8.1, 8.2, 8.2, 8.2, 8.2]
        },
        {
            id: 'apparel',
            name: 'Apparel',
            weight: 0.025,
            icon: 'üëï',
            proxy: 'Import price indexes + retail sales data',
            defaultRate: 0.8,
            min: -8, max: 10,
            history: [1.5, 1.2, 0.8, 0.5, 0.3, 0.5, 0.6, 0.7, 0.8, 0.8, 0.8, 0.8]
        },
        {
            id: 'recreation',
            name: 'Recreation',
            weight: 0.052,
            icon: 'üéÆ',
            proxy: 'Consumer electronics prices + streaming/entertainment CPI',
            defaultRate: 1.5,
            min: -5, max: 8,
            history: [2.0, 1.8, 1.6, 1.5, 1.4, 1.4, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5]
        },
        {
            id: 'education',
            name: 'Education & Communication',
            weight: 0.058,
            icon: 'üìö',
            proxy: 'Tuition indexes + telecom price data',
            defaultRate: 1.9,
            min: -3, max: 8,
            history: [2.2, 2.1, 2.0, 2.0, 1.9, 1.9, 1.9, 1.9, 1.9, 1.9, 1.9, 1.9]
        },
        {
            id: 'other',
            name: 'Other Goods & Services',
            weight: 0.101,
            icon: 'üì¶',
            proxy: 'Personal care, tobacco, financial services, misc',
            defaultRate: 3.2,
            min: -5, max: 12,
            history: [3.5, 3.4, 3.3, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2, 3.2]
        }
    ];

    // Current slider values
    let currentValues = {};

    // Historical backtest data (simulated model vs actual)
    const backtestData = [
        { month: 'Jan 2025', actual: 3.0, nowcast: 2.9 },
        { month: 'Feb 2025', actual: 2.8, nowcast: 2.9 },
        { month: 'Mar 2025', actual: 2.4, nowcast: 2.5 },
        { month: 'Apr 2025', actual: 2.3, nowcast: 2.4 },
        { month: 'May 2025', actual: 2.3, nowcast: 2.2 },
        { month: 'Jun 2025', actual: 2.6, nowcast: 2.5 },
        { month: 'Jul 2025', actual: 2.9, nowcast: 2.8 },
        { month: 'Aug 2025', actual: 2.5, nowcast: 2.6 },
        { month: 'Sep 2025', actual: 2.4, nowcast: 2.4 },
        { month: 'Oct 2025', actual: 2.6, nowcast: 2.5 },
        { month: 'Nov 2025', actual: 2.7, nowcast: 2.8 },
        { month: 'Dec 2025', actual: 2.9, nowcast: 2.8 },
    ];

    // Initialize
    function init() {
        components.forEach(c => { currentValues[c.id] = c.defaultRate; });
        renderComponents();
        renderSliders();
        renderHistory();
        updateNowcast();
    }

    function calculateNowcast() {
        let cpi = 0;
        components.forEach(c => {
            cpi += c.weight * currentValues[c.id];
        });
        return cpi;
    }

    function calculateMoM() {
        // Rough MoM approximation from YoY
        const yoy = calculateNowcast();
        // Assume previous 11 months averaged to give a base
        return yoy / 12;
    }

    function getSignal(cpi) {
        if (cpi >= 4.0) return { text: 'HOT', cls: 'badge-hot' };
        if (cpi >= 3.0) return { text: 'WARM', cls: 'badge-warm' };
        if (cpi >= 2.0) return { text: 'TARGET RANGE', cls: 'badge-cool' };
        return { text: 'COOL', cls: 'badge-cold' };
    }

    function updateNowcast() {
        const cpi = calculateNowcast();
        const mom = calculateMoM();
        const signal = getSignal(cpi);

        document.getElementById('nowcast-value').textContent = cpi.toFixed(1) + '%';
        document.getElementById('nowcast-mom').textContent = (mom >= 0 ? '+' : '') + mom.toFixed(2) + '% est.';

        const badgeEl = document.getElementById('nowcast-badge');
        badgeEl.innerHTML = `<span class="nowcast-badge ${signal.cls}">${signal.text}</span>`;

        // Color the number
        const numEl = document.getElementById('nowcast-value');
        if (cpi >= 4.0) numEl.style.color = 'var(--red)';
        else if (cpi >= 3.0) numEl.style.color = 'var(--yellow)';
        else if (cpi >= 2.0) numEl.style.color = 'var(--green)';
        else numEl.style.color = 'var(--accent)';

        // Update gauge
        updateGauge(cpi);

        // Update component cards values
        components.forEach(c => {
            const valEl = document.getElementById(`comp-val-${c.id}`);
            const changeEl = document.getElementById(`comp-change-${c.id}`);
            if (valEl) {
                const v = currentValues[c.id];
                valEl.textContent = (v >= 0 ? '+' : '') + v.toFixed(1) + '%';
                valEl.style.color = v > 3 ? 'var(--red)' : v > 0 ? 'var(--yellow)' : 'var(--green)';

                const contrib = c.weight * v;
                changeEl.textContent = (contrib >= 0 ? '+' : '') + contrib.toFixed(2) + '% contrib';
                changeEl.className = 'component-change ' + (contrib > 0.5 ? 'change-up' : contrib < -0.1 ? 'change-down' : 'change-flat');
            }
        });
    }

    function updateGauge(cpi) {
        // Map CPI from -1% to 7% onto 0-180 degrees
        const minVal = -1, maxVal = 7;
        const pct = Math.max(0, Math.min(1, (cpi - minVal) / (maxVal - minVal)));
        const totalArc = 236; // approximate arc length
        const arcLen = pct * totalArc;

        const arcEl = document.getElementById('gauge-arc');
        arcEl.setAttribute('stroke-dasharray', `${arcLen} ${totalArc}`);

        // Color
        if (cpi >= 4) arcEl.setAttribute('stroke', '#f87171');
        else if (cpi >= 3) arcEl.setAttribute('stroke', '#fbbf24');
        else if (cpi >= 2) arcEl.setAttribute('stroke', '#34d399');
        else arcEl.setAttribute('stroke', '#7c5cfc');

        // Needle angle: 180deg (left) to 0deg (right)
        const angle = Math.PI - (pct * Math.PI);
        const nx = 90 + 70 * Math.cos(angle);
        const ny = 90 - 70 * Math.sin(angle);
        const needle = document.getElementById('gauge-needle');
        needle.setAttribute('x2', nx);
        needle.setAttribute('y2', ny);
    }

    function renderComponents() {
        const grid = document.getElementById('components-grid');
        grid.innerHTML = components.map(c => {
            const v = currentValues[c.id];
            const contrib = c.weight * v;
            // Sparkline
            const sparkPoints = c.history.map((val, i) => {
                const x = (i / (c.history.length - 1)) * 100;
                const range = Math.max(...c.history) - Math.min(...c.history) || 1;
                const y = 38 - ((val - Math.min(...c.history)) / range) * 34;
                return `${x},${y}`;
            }).join(' ');
            const areaPoints = sparkPoints + ` 100,40 0,40`;

            return `
            <div class="component-card">
                <div class="component-header">
                    <span class="component-name">${c.icon} ${c.name}</span>
                    <span class="component-weight">${(c.weight * 100).toFixed(1)}% weight</span>
                </div>
                <div class="component-value" id="comp-val-${c.id}" style="color:${v > 3 ? 'var(--red)' : v > 0 ? 'var(--yellow)' : 'var(--green)'}">
                    ${v >= 0 ? '+' : ''}${v.toFixed(1)}%
                </div>
                <div class="component-change ${contrib > 0.5 ? 'change-up' : contrib < -0.1 ? 'change-down' : 'change-flat'}" id="comp-change-${c.id}">
                    ${contrib >= 0 ? '+' : ''}${contrib.toFixed(2)}% contrib
                </div>
                <div class="sparkline">
                    <svg viewBox="0 0 100 40" preserveAspectRatio="none">
                        <polygon class="spark-area" points="${areaPoints}"/>
                        <polyline class="spark-line" points="${sparkPoints}"/>
                    </svg>
                </div>
                <div style="font-size:0.7rem; color:var(--text-dim); margin-top:0.3rem;">Proxy: ${c.proxy}</div>
            </div>`;
        }).join('');
    }

    function renderSliders() {
        const container = document.getElementById('sliders-container');
        container.innerHTML = components.map(c => `
            <div class="slider-row">
                <span class="slider-label">${c.icon} ${c.name}</span>
                <input type="range" class="slider-input" id="slider-${c.id}"
                    min="${c.min}" max="${c.max}" step="0.1" value="${c.defaultRate}"
                    oninput="onSliderChange('${c.id}', this.value)">
                <span class="slider-value" id="slider-val-${c.id}">${c.defaultRate.toFixed(1)}%</span>
            </div>
        `).join('');
    }

    function onSliderChange(id, value) {
        const v = parseFloat(value);
        currentValues[id] = v;
        document.getElementById(`slider-val-${id}`).textContent = v.toFixed(1) + '%';
        updateNowcast();
    }

    function resetSliders() {
        components.forEach(c => {
            currentValues[c.id] = c.defaultRate;
            document.getElementById(`slider-${c.id}`).value = c.defaultRate;
            document.getElementById(`slider-val-${c.id}`).textContent = c.defaultRate.toFixed(1) + '%';
        });
        updateNowcast();
    }

    function renderHistory() {
        const tbody = document.getElementById('history-body');
        tbody.innerHTML = backtestData.map(row => {
            const err = row.nowcast - row.actual;
            const absErr = Math.abs(err);
            const cls = absErr <= 0.1 ? 'accurate-cell' : 'error-cell';
            const dir = err > 0 ? '‚Üë Over' : err < 0 ? '‚Üì Under' : '‚úì Exact';
            return `
            <tr>
                <td>${row.month}</td>
                <td>${row.actual.toFixed(1)}%</td>
                <td>${row.nowcast.toFixed(1)}%</td>
                <td class="${cls}">${err >= 0 ? '+' : ''}${err.toFixed(1)}%</td>
                <td class="${cls}">${dir}</td>
            </tr>`;
        }).join('');
    }

    // Boot
    init();
    </script>
</body>
</html>